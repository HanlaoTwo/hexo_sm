---
title: select 执行过程
date: 2018-07-10 21:09:19
tags: 数据库
---
```
操作数据库
执行简单查询
应用程序与数据库之间最常见的操作是从数据库中查询并且提取数据。在标准的 SQL 语句规范中，这一过程是使用关键字 SELECT 的。
一个通过 DBI 执行的标准简单查询包括以下四个阶段：
准备阶段（Perpare SQL statement）：
通过调用 prepare（）方法，准备阶段解析 SQL 语句，对 SQL 语句进行验证，并且返回一个执行语句句柄，这个句柄代表将在数据库内被执行的这条 SQL 语句。
执行阶段（Execute select statement）：
通过调用 execute（）方法，执行阶段执行 SQL 语句，查询数据库，并且以被查询的数据填充 Perl 的数据结构。但是，在这一阶段中，你的 Perl 应用程序并未真正地访问到被查询的数据。
数据抽取阶段（fetching date）：
第三阶段被称为数据抽取阶段，在这一阶段实际的数据从数据库中被抽取出来，通过调用 fetch（）方法族的一组方法。数据抽取阶段从数据库得到查询所得的数据，以每一条数据为单位，注入 Perl 的数据结构。DBI 提供了多种方法对数据进行抽取，可以将被抽取的数据用一个列表，一个指向数组的引用，或是一个指向哈希表的引用的方式提供给应用程序。而且每条记录中字段的顺序也是由 SQL 语句中指定的顺序所决定。一个包含三种方法的例子见程序四。
完成阶段（finishing date fetch）：
最后一个阶段被称为完成阶段，这个阶段主要释放资源，并且清理相关数据结构中保存的历史信息，通过显式地调用 finish（）方法来完成。当一个执行语句句柄（statement handler）被成功执行后，它的状态会被标记成为活跃。你可以通过访问执行语句句柄的 Active 属性来访问它。在用户执行 fetch（）方法，从数据库中抽取了最后一列数据之后，数据库驱动自动关闭数据库中正在进行地和这个执行语句句柄有关的工作，并且重置 Active 属性为不活跃状态。这一切工作都是在读取了最后一列数据之后被自动触发，在大多数情况下，用户并不需要额外地关心这一过程中后台所作的工作。某些额外情况，需要应用程序主动调用 finish（）方法释放资源。一个典型的例子就是：当数据库占用了数目可观的磁盘空间存储临时文件，存放查询结果，而应用程序又不需要保存所有的查询结果。比如执行一条形如 “SELECT EMP_DEP, count(*) FROM EMP GROUP BY EMP_DEP ORDER BY count(*) DESC”的 SQL 语句，在应用程序只需要部分统计结果的情况，应该显示调用 finish（）方法，释放被申请和占用的机器资源。